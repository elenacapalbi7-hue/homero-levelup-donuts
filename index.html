<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, orientation=landscape">
    <title>The Homer World 1-1</title>
    <style>
        body { margin: 0; background: #5c94fc; overflow: hidden; touch-action: none; font-family: 'Arial Black', sans-serif; }
        canvas { display: block; width: 100vw; height: 100vh; image-rendering: pixelated; }
        #ui { position: absolute; top: 10px; left: 0; width: 100%; display: flex; justify-content: space-around; color: white; text-shadow: 2px 2px #000; pointer-events: none; z-index: 10; font-size: 14px; }
        #controls { position: absolute; bottom: 40px; width: 100%; display: flex; justify-content: space-between; padding: 0 40px; box-sizing: border-box; z-index: 20; }
        .btn { width: 65px; height: 65px; background: rgba(255, 255, 255, 0.2); border: 2px solid white; border-radius: 50%; display: flex; align-items: center; justify-content: center; font-size: 30px; color: white; user-select: none; -webkit-tap-highlight-color: transparent; pointer-events: auto; }
    </style>
</head>
<body>

<div id="ui">
    <div>HOMERO<br>000000</div>
    <div>DONAS<br>üç© x <span id="donutCount">0</span></div>
    <div>VIDAS<br>‚ù§Ô∏è x <span id="lifeCount">3</span></div>
</div>

<div id="controls">
    <div style="display:flex; gap:20px;">
        <div class="btn" id="left">‚¨ÖÔ∏è</div>
        <div class="btn" id="right">‚û°Ô∏è</div>
    </div>
    <div class="btn" id="jump">‚¨ÜÔ∏è</div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

let donuts = 0, lives = 3, camX = 0, frame = 0;
let blocks = [], enemies = [], items = [], particles = [];
let keys = { left: false, right: false };

const player = {
    x: 100, y: 0, w: 35, h: 55, vx: 0, vy: 0,
    onGround: false, isSuper: false, superTimer: 0, dir: 1
};

function init() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    player.y = canvas.height - 150;
    generateLevel();
    loop();
}

function generateLevel() {
    blocks = []; enemies = []; items = [];
    const groundY = canvas.height - 60;
    
    for(let i=0; i<600; i++) {
        // Suelo con agujeros t√°cticos
        if (!(i > 60 && i < 65) && !(i > 150 && i < 156) && !(i > 250 && i < 255)) {
            blocks.push({x: i*40, y: groundY, t:'brick', solid: true});
        }

        // Estructuras variadas (no repetitivas)
        if(i === 20) createPlatform(i*40, groundY-140, 5, '?', 'beer');
        if(i === 45) createPlatform(i*40, groundY-140, 3, 'B', 'none');
        if(i === 46) blocks.push({x: i*40, y: groundY-240, t:'S', c:'multi', hits:5}); // Bloque Estrella/Dona
        
        if(i === 80) createStairs(i*40, groundY, 4, true); // Escalera
        if(i === 100) enemies.push({x: i*40, y: groundY-40, vx: -2, dead: false});
        
        // Plantas nucleares (Tuber√≠as)
        if(i === 35 || i === 120 || i === 200) {
            blocks.push({x: i*40, y: groundY-40, t:'pipe', solid:true});
            blocks.push({x: i*40, y: groundY-80, t:'pipe', solid:true});
        }
    }
}

function createPlatform(x, y, len, type, content) {
    for(let i=0; i<len; i++) {
        blocks.push({x: x + (i*40), y: y, t: (i===Math.floor(len/2)?type:'B'), c: content, solid: true});
    }
}

function createStairs(x, y, steps, right) {
    for(let i=1; i<=steps; i++) {
        for(let j=0; j<i; j++) {
            blocks.push({x: x + (i*40), y: y - (j*40) - 40, t:'B', solid: true});
        }
    }
}

function update() {
    // Movimiento
    if (keys.left) { player.vx = -5; player.dir = -1; }
    else if (keys.right) { player.vx = 5; player.dir = 1; }
    else player.vx *= 0.8;

    player.vy += 0.8; // Gravedad
    player.x += player.vx;
    player.y += player.vy;

    // C√°mara suave
    let targetCam = player.x - canvas.width/4;
    camX += (targetCam - camX) * 0.1;

    if (player.superTimer > 0) {
        player.superTimer--;
        if (player.superTimer === 0) player.isSuper = false;
    }

    // Colisiones
    player.onGround = false;
    blocks.forEach((b, index) => {
        if (player.x + player.w > b.x && player.x < b.x + 40 && player.y + player.h > b.y && player.y < b.y + 40) {
            // Piso
            if (player.vy > 0 && player.y + player.h - player.vy <= b.y) {
                player.y = b.y - player.h; player.vy = 0; player.onGround = true;
            }
            // Cabeza (Activar Bloques)
            else if (player.vy < 0 && player.y - player.vy >= b.y + 40) {
                player.y = b.y + 40; player.vy = 2;
                if(b.t === '?' || b.t === 'S') {
                    if(b.c === 'beer') { 
                        items.push({x: b.x, y: b.y-40, t:'üç∫', vx: 2, vy: -5}); 
                        b.t = 'U'; b.c = null;
                    } else if (b.c === 'multi') {
                        spawnParticle(b.x + 10, b.y - 20, 'üç©');
                        donuts++; b.hits--;
                        if(b.hits <= 0) b.t = 'U';
                    } else {
                        spawnParticle(b.x + 10, b.y - 20, 'üç©');
                        donuts++; b.t = 'U';
                    }
                } else if (b.t === 'B' && player.isSuper) {
                    blocks.splice(index, 1); // Romper bloque
                }
            }
        }
    });

    // Enemigos
    enemies.forEach(en => {
        if(en.dead) return;
        en.x += en.vx;
        blocks.forEach(b => { if(en.x < b.x+40 && en.x+40 > b.x && en.y > b.y-40) en.vx *= -1; });
        
        if(player.x < en.x+35 && player.x+35 > en.x && player.y < en.y+35 && player.y+55 > en.y) {
            if(player.vy > 0) { en.dead = true; player.vy = -10; } // Pisar
            else if (!player.isSuper) { resetPlayer(); } // Morir
        }
    });

    // Items
    items.forEach((it, idx) => {
        it.vy += 0.5; it.x += it.vx; it.y += it.vy;
        blocks.forEach(b => { if(it.y + 30 > b.y && it.x < b.x+40 && it.x+30 > b.x) it.vy = -2; });
        if(Math.hypot(player.x - it.x, player.y - it.y) < 40) {
            player.isSuper = true; player.superTimer = 600; items.splice(idx, 1);
        }
    });

    if(player.y > canvas.height) resetPlayer();
}

function spawnParticle(x, y, t) {
    particles.push({x, y, t, vy: -8, timer: 30});
}

function resetPlayer() {
    lives--; 
    if(lives <= 0) { alert("¬°Ayuuuda! Game Over"); lives = 3; donuts = 0; generateLevel(); }
    player.x = 100; player.y = 0; player.vx = 0; player.vy = 0;
}

function draw() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(-camX, 0);

    // Dibujar Bloques
    blocks.forEach(b => {
        if(b.t === 'brick') ctx.fillStyle = '#944828';
        else if(b.t === 'B') ctx.fillStyle = '#e76e33';
        else if(b.t === '?') ctx.fillStyle = '#f39c12';
        else if(b.t === 'S') ctx.fillStyle = '#f1c40f';
        else if(b.t === 'pipe') ctx.fillStyle = '#27ae60';
        else ctx.fillStyle = '#7f8c8d';

        ctx.fillRect(b.x, b.y, 39, 39);
        ctx.strokeStyle = 'black'; ctx.strokeRect(b.x, b.y, 40, 40);
        if(b.t === '?' || b.t === 'S') { ctx.fillStyle='white'; ctx.fillText(b.t==='S'?'‚≠ê':'?', b.x+15, b.y+25); }
    });

    // Flanders
    enemies.forEach(en => { if(!en.dead) ctx.fillText("üë®‚Äçüè´", en.x, en.y + 30); });

    // Homero
    ctx.font = player.isSuper ? "60px Arial" : "45px Arial";
    let hScale = player.isSuper ? 1.5 : 1;
    ctx.fillText(player.dir > 0 ? "üë®‚Äçü¶≤" : "üë®‚Äçü¶≤", player.x, player.y + (45 * hScale));
    ctx.font = player.isSuper ? "40px Arial" : "30px Arial";
    ctx.fillText("üëï", player.x + (2 * hScale), player.y + (70 * hScale));
    ctx.fillText("üëñ", player.x + (2 * hScale), player.y + (95 * hScale));

    // Part√≠culas y Items
    particles.forEach((p, i) => { p.y += p.vy; p.timer--; ctx.fillText(p.t, p.x, p.y); if(p.timer<0) particles.splice(i,1); });
    items.forEach(it => ctx.fillText(it.t, it.x, it.y+25));

    // Final - Casa
    ctx.font = "120px Arial"; ctx.fillText("üè†", 22000, canvas.height - 180);
    ctx.font = "50px Arial"; ctx.fillText("üë©‚Äçü¶±üëßüë¶üë∂", 22050, canvas.height - 120);

    ctx.restore();
    document.getElementById('donutCount').innerText = donuts;
    document.getElementById('lifeCount').innerText = lives;
}

// Controles
const setupBtn = (id, key) => {
    const el = document.getElementById(id);
    el.ontouchstart = (e) => { e.preventDefault(); if(key === 'jump') { if(player.onGround) player.vy = -16; } else keys[key] = true; };
    el.ontouchend = () => { if(key !== 'jump') keys[key] = false; };
};
setupBtn('left', 'left'); setupBtn('right', 'right'); setupBtn('jump', 'jump');

function loop() { frame++; update(); draw(); requestAnimationFrame(loop); }
window.onload = init;
window.onresize = () => { canvas.width = window.innerWidth; canvas.height = window.innerHeight; };
</script>
</body>
</html>
