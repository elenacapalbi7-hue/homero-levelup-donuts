<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Homero Multiverso: Versi√≥n Pro</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; touch-action: none; }
        canvas { display: block; width: 100vw; height: 100vh; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; pointer-events: none; z-index: 100; }
        .hud { background: rgba(0,0,0,0.9); padding: 12px; border: 2px solid #ff69b4; border-radius: 12px; display: inline-block; min-width: 180px; }
    </style>
</head>
<body>

<div id="ui">
    <div class="hud">
        <strong id="lvl-tag">Nivel 1: RITMO</strong><br>
        Puntos: <span id="puntos">0</span>/10
    </div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let nivel = 1, puntos = 0, frame = 0, items = [];
let jugador = { x: 50, y: 0, vy: 0, saltos: 0, d: 'parado' }; 

function resize() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
window.addEventListener('resize', resize); resize();

// --- CONTROLES MEJORADOS ---
let touchStartX = 0;
let touchStartY = 0;

window.addEventListener('touchstart', (e) => {
    touchStartX = e.touches[0].clientX;
    touchStartY = e.touches[0].clientY;

    if (nivel === 1 && jugador.saltos < 2) { jugador.vy = -14; jugador.saltos++; }
    if (nivel === 4) { jugador.vy = -10; } 
});

window.addEventListener('touchmove', (e) => {
    e.preventDefault();
    let t = e.touches[0];
    
    if (nivel === 3) { // L√≥gica de deslizamiento (Swipe) para Snake
        let diffX = t.clientX - touchStartX;
        let diffY = t.clientY - touchStartY;
        if (Math.abs(diffX) > Math.abs(diffY)) {
            jugador.d = diffX > 0 ? 'r' : 'l';
        } else {
            jugador.d = diffY > 0 ? 'd' : 'u';
        }
    }

    if (nivel === 2 || nivel === 5) { 
        jugador.x = t.clientX - 20; 
        if(nivel === 2) jugador.y = t.clientY - 30; 
    }
}, {passive: false});

// --- MOTORES ---

function motorRitmo() {
    ctx.fillStyle = "#1a1a2e"; ctx.fillRect(0,0,canvas.width, canvas.height);
    actualizarFisica(canvas.height-110);
    if(frame % 130 === 0) items.push({x: canvas.width, y: canvas.height-95, t: 'c'});
    if(frame % 170 === 0) items.push({x: canvas.width, y: canvas.height-220, t: 'd'});
    items.forEach((it, i) => {
        it.x -= 5; ctx.font = "35px Arial"; ctx.fillText(it.t === 'c' ? "üåµ" : "üç©", it.x, it.y);
        if (Math.hypot(jugador.x - it.x, jugador.y - it.y) < (it.t === 'c' ? 25 : 50)) {
            it.t === 'c' ? reiniciar() : (items.splice(i, 1), sumarPunto());
        }
    });
    dibujarHomero();
}

function motorSurvivor() {
    ctx.fillStyle = "#2d3436"; ctx.fillRect(0,0,canvas.width, canvas.height);
    if(frame % 100 === 0) items.push({x: Math.random()*canvas.width, y: -50, t: 'z', s: 1.6});
    if(frame % 150 === 0) items.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, t: 'd'});
    items.forEach((it, i) => {
        if(it.t === 'z') {
            let a = Math.atan2(jugador.y - it.y, jugador.x - it.x);
            it.x += Math.cos(a) * it.s; it.y += Math.sin(a) * it.s;
            ctx.fillText("üßü", it.x, it.y);
            if(Math.hypot(jugador.x - it.x, jugador.y - it.y) < 30) reiniciar();
        } else {
            ctx.fillText("üç©", it.x, it.y);
            if(Math.hypot(jugador.x - it.x, jugador.y - it.y) < 60) { items.splice(i, 1); sumarPunto(); }
        }
    });
    dibujarHomero();
}

function motorSnake() { 
    ctx.fillStyle = "#1b4d3e"; ctx.fillRect(0,0,canvas.width, canvas.height);
    let speed = 5;
    
    // Movimiento
    if(jugador.d === 'r') jugador.x += speed; 
    if(jugador.d === 'l') jugador.x -= speed;
    if(jugador.d === 'u') jugador.y -= speed; 
    if(jugador.d === 'd') jugador.y += speed;
    
    // Teletransporte de bordes (Para que no pierda al chocar con la pared)
    if(jugador.x < 0) jugador.x = canvas.width;
    if(jugador.x > canvas.width) jugador.x = 0;
    if(jugador.y < 0) jugador.y = canvas.height;
    if(jugador.y > canvas.height) jugador.y = 0;

    if(frame % 60 === 0) items.push({x: 50+Math.random()*(canvas.width-100), y: 50+Math.random()*(canvas.height-100), t: 'd'});

    items.forEach((it, i) => {
        ctx.fillText("üç©", it.x, it.y);
        if(Math.hypot(jugador.x - it.x, jugador.y - it.y) < 45) { items.splice(i, 1); sumarPunto(); }
    });
    
    if(jugador.d === 'parado') {
        ctx.fillStyle = "white"; ctx.font = "20px Arial";
        ctx.fillText("DESLIZA PARA MOVER A HOMERO", canvas.width/2-140, canvas.height/2 + 100);
    }
    dibujarHomero();
}

function motorFlappy() { 
    ctx.fillStyle = "#4ec0ca"; ctx.fillRect(0,0,canvas.width, canvas.height);
    jugador.vy += 0.5; jugador.y += jugador.vy;
    jugador.x = 80;

    if(frame % 90 === 0) {
        let gap = 200;
        let h = 100 + Math.random() * (canvas.height - gap - 200);
        items.push({x: canvas.width, y: h, t: 'p', g: gap});
    }

    items.forEach((it, i) => {
        it.x -= 5;
        ctx.fillStyle = "#2ecc71"; 
        ctx.fillRect(it.x, 0, 60, it.y); // Tubo arriba
        ctx.fillRect(it.x, it.y + it.g, 60, canvas.height); // Tubo abajo
        
        if(jugador.x + 30 > it.x && jugador.x < it.x + 60 && (jugador.y < it.y || jugador.y + 40 > it.y + it.g)) reiniciar();
        if(it.x === 20) sumarPunto();
    });

    if(jugador.y > canvas.height || jugador.y < 0) reiniciar();
    dibujarHomero();
}

function motorCatch() { 
    ctx.fillStyle = "#34495e"; ctx.fillRect(0,0,canvas.width, canvas.height);
    jugador.y = canvas.height - 100;
    if(frame % 50 === 0) items.push({x: Math.random()*canvas.width, y: -50, t: Math.random() > 0.2 ? 'b' : 'bomb'});
    items.forEach((it, i) => {
        it.y += 6;
        ctx.fillText(it.t === 'b' ? "üç∫" : "üí£", it.x, it.y);
        if(Math.hypot(jugador.x - it.x, jugador.y - it.y) < 55) {
            if(it.t === 'bomb') reiniciar();
            else { items.splice(i, 1); sumarPunto(); }
        }
    });
    dibujarHomero();
}

// --- UTILIDADES ---
function actualizarFisica(s) {
    jugador.vy += 0.8; jugador.y += jugador.vy;
    if(jugador.y > s) { jugador.y = s; jugador.vy = 0; jugador.saltos = 0; }
}

function dibujarHomero() {
    ctx.fillStyle = "yellow"; ctx.fillRect(jugador.x, jugador.y, 40, 60);
    ctx.strokeStyle = "white"; ctx.strokeRect(jugador.x, jugador.y, 40, 60);
}

function sumarPunto() {
    puntos++; document.getElementById('puntos').innerText = puntos;
    if(puntos >= 10) { 
        nivel++; puntos = 0; items = []; frame = 0; 
        jugador.x = canvas.width/2; jugador.y = canvas.height/2; jugador.d = 'parado';
        if(nivel > 5) nivel = 1;
        const n = ["", "1: RITMO", "2: SURVIVOR", "3: SNAKE", "4: FLAPPY", "5: CATCH"];
        document.getElementById('lvl-tag').innerText = "Nivel " + n[nivel];
        alert("¬°Nivel " + (nivel-1) + " superado!");
    }
}

function reiniciar() { 
    puntos = 0; items = []; frame = 0; 
    jugador.x = canvas.width/2; jugador.y = canvas.height/2; jugador.d = 'parado';
    alert("¬°D'oh!"); 
}

function loop() {
    ctx.clearRect(0,0,canvas.width, canvas.height); frame++;
    if(nivel===1) motorRitmo(); else if(nivel===2) motorSurvivor(); else if(nivel===3) motorSnake();
    else if(nivel===4) motorFlappy(); else if(nivel===5) motorCatch();
    requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
