<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Homer: El Banquete de Donas</title>
    <style>
        /* ESTILO GENERAL Y LIMPIO */
        body { margin: 0; background: #222; overflow: hidden; font-family: 'Arial', sans-serif; touch-action: none; }
        
        #game-container { 
            position: relative; 
            width: 100vw; 
            height: 100vh; 
            background: #87CEEB; /* Azul cielo Simpson */
            margin: 0 auto;
            overflow: hidden;
        }

        /* UI SUPERIOR */
        #ui {
            position: absolute;
            top: 10px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            box-sizing: border-box;
            font-size: 24px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
            pointer-events: none;
        }

        /* PANTALLAS DE MENSAJE (Inicio / Game Over) */
        #overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.85);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
            text-align: center;
        }
        
        h1 { font-size: 40px; margin: 0 0 20px 0; color: #FFD700; text-shadow: 3px 3px #000; }
        p { font-size: 18px; line-height: 1.5; color: #fff; margin-bottom: 30px; }
        
        .btn-start {
            padding: 15px 40px;
            font-size: 24px;
            background: #FF5722;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 4px #bf360c;
        }
        .btn-start:active { transform: translateY(4px); box-shadow: 0 0 #bf360c; }

        /* CONTROLES T√ÅCTILES */
        #controls {
            position: absolute;
            bottom: 30px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 40px;
            box-sizing: border-box;
            pointer-events: none; /* Para que los toques pasen a los botones */
        }

        .touch-btn {
            width: 80px;
            height: 80px;
            background: rgba(255, 255, 255, 0.3);
            border: 3px solid white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 40px;
            pointer-events: auto;
            user-select: none;
            color: white;
        }
        
        .touch-btn:active { background: rgba(255,255,255,0.6); }
        
        canvas { display: block; width: 100%; height: 100%; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui">
        <div>üç© <span id="score">0</span></div>
        <div>‚ù§Ô∏è <span id="lives">3</span></div>
    </div>

    <div id="overlay">
        <h1 id="title">üç© EL BANQUETE üç©</h1>
        <div id="instructions">
            <p>¬°Ayuda a Homero!<br>Atrapa las Donas.<br>Esquiva el Br√≥coli.</p>
        </div>
        <button class="btn-start" onclick="startGame()">JUGAR</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="controls">
        <div class="touch-btn" id="btnLeft">‚¨ÖÔ∏è</div>
        <div class="touch-btn" id="btnRight">‚û°Ô∏è</div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const overlay = document.getElementById('overlay');
    const title = document.getElementById('title');
    const instructions = document.getElementById('instructions');

    let animationId;
    let isPlaying = false;
    let score = 0;
    let lives = 3;
    let frameCount = 0;
    let difficulty = 1;

    // Configuraci√≥n del Jugador
    const player = {
        x: 0,
        y: 0,
        width: 80,
        height: 100,
        speed: 7,
        velX: 0,
        emoji: "üë®‚Äçü¶≤",
        isPowerUp: false
    };

    // Arrays de objetos
    let items = [];
    
    // Controles
    let keys = { left: false, right: false };

    // Ajustar tama√±o de pantalla
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        // Posicionar a Homero en el suelo
        player.y = canvas.height - player.height - 20; 
        if(player.x === 0) player.x = canvas.width / 2 - player.width / 2;
    }
    window.addEventListener('resize', resize);
    resize();

    // Iniciar Juego
    function startGame() {
        items = [];
        score = 0;
        lives = 3;
        difficulty = 1;
        player.isPowerUp = false;
        player.speed = 7;
        player.x = canvas.width / 2 - player.width / 2;
        
        scoreEl.innerText = score;
        livesEl.innerText = lives;
        
        isPlaying = true;
        overlay.style.display = 'none';
        
        cancelAnimationFrame(animationId);
        loop();
    }

    // Game Over
    function gameOver() {
        isPlaying = false;
        overlay.style.display = 'flex';
        title.innerText = "¬°D'OH!";
        instructions.innerHTML = `<p>Juego Terminado<br>Comiste <b>${score}</b> donas.</p>`;
    }

    // Generar Objetos
    function spawnItem() {
        const typeRoll = Math.random();
        let type = 'donut';
        let emoji = 'üç©';
        let speed = 3 + (difficulty * 0.5);

        // 10% probabilidad de s√°ndwich, 30% br√≥coli, 60% dona
        if (typeRoll < 0.1) {
            type = 'sandwich';
            emoji = 'ü•™';
            speed *= 1.5; // Cae m√°s r√°pido
        } else if (typeRoll < 0.4) {
            type = 'bad';
            emoji = 'ü•¶';
        }

        const size = 50;
        const x = Math.random() * (canvas.width - size);
        
        items.push({ x, y: -60, size, type, emoji, speed });
    }

    // Bucle Principal
    function loop() {
        if (!isPlaying) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. Dibujar Fondo (C√©sped simple abajo)
        ctx.fillStyle = "#4CAF50";
        ctx.fillRect(0, canvas.height - 20, canvas.width, 20);

        // 2. Mover y Dibujar Jugador
        if (keys.left && player.x > 0) player.x -= player.speed;
        if (keys.right && player.x < canvas.width - player.width) player.x += player.speed;

        // Efecto visual si tiene power-up
        if(player.isPowerUp) {
            ctx.globalAlpha = 0.5;
            ctx.fillStyle = 'yellow';
            ctx.beginPath();
            ctx.arc(player.x + player.width/2, player.y + player.height/2, 60, 0, Math.PI*2);
            ctx.fill();
            ctx.globalAlpha = 1.0;
        }

        ctx.font = `${player.height}px Arial`;
        ctx.textAlign = 'left';
        ctx.fillText(player.emoji, player.x, player.y + player.height - 10);

        // 3. Manejar Objetos que caen
        if (frameCount % (60 - Math.min(40, difficulty * 2)) === 0) {
            spawnItem();
        }

        for (let i = items.length - 1; i >= 0; i--) {
            let item = items[i];
            item.y += item.speed;

            // Dibujar objeto
            ctx.font = `${item.size}px Arial`;
            ctx.fillText(item.emoji, item.x, item.y + item.size);

            // Detecci√≥n de colisi√≥n (Rect√°ngulo simple)
            if (
                player.x < item.x + item.size &&
                player.x + player.width > item.x &&
                player.y < item.y + item.size &&
                player.y + player.height > item.y
            ) {
                // Toca el objeto
                if (item.type === 'donut') {
                    score++;
                    scoreEl.innerText = score;
                    if(score % 10 === 0) difficulty++; // Aumentar dificultad
                } else if (item.type === 'sandwich') {
                    activatePowerUp();
                } else if (item.type === 'bad') {
                    lives--;
                    livesEl.innerText = lives;
                    // Efecto rojo pantalla
                    ctx.fillStyle = 'rgba(255,0,0,0.3)';
                    ctx.fillRect(0,0,canvas.width,canvas.height);
                    if(lives <= 0) gameOver();
                }
                items.splice(i, 1);
                continue;
            }

            // Eliminar si sale de pantalla
            if (item.y > canvas.height) {
                items.splice(i, 1);
            }
        }

        frameCount++;
        animationId = requestAnimationFrame(loop);
    }

    function activatePowerUp() {
        player.speed = 12; // Super velocidad
        player.isPowerUp = true;
        setTimeout(() => {
            player.speed = 7;
            player.isPowerUp = false;
        }, 5000); // Dura 5 segundos
    }

    // --- CONTROLES ---
    
    // Teclado (PC)
    window.addEventListener('keydown', e => {
        if(e.key === 'ArrowLeft') keys.left = true;
        if(e.key === 'ArrowRight') keys.right = true;
    });
    window.addEventListener('keyup', e => {
        if(e.key === 'ArrowLeft') keys.left = false;
        if(e.key === 'ArrowRight') keys.right = false;
    });

    // T√°ctil (M√≥vil)
    const btnLeft = document.getElementById('btnLeft');
    const btnRight = document.getElementById('btnRight');

    const addTouch = (elem, dir) => {
        elem.addEventListener('touchstart', (e) => { e.preventDefault(); keys[dir] = true; });
        elem.addEventListener('touchend', (e) => { e.preventDefault(); keys[dir] = false; });
        // Mouse fallback para probar en PC clickeando
        elem.addEventListener('mousedown', (e) => { keys[dir] = true; });
        elem.addEventListener('mouseup', (e) => { keys[dir] = false; });
    };

    addTouch(btnLeft, 'left');
    addTouch(btnRight, 'right');

</script>
</body>
</html>
