<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Homero: Pac-Man Maze Pro</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; touch-action: none; }
        canvas { display: block; width: 100vw; height: 100vh; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; pointer-events: none; z-index: 100; }
        .hud { background: rgba(0,0,0,0.9); padding: 10px; border: 2px solid #ff69b4; border-radius: 12px; display: inline-block; }
    </style>
</head>
<body>

<div id="ui">
    <div class="hud">
        <strong id="lvl-tag">Nivel 3: PAC-MAN</strong><br>
        Donas: <span id="puntos">0</span>/10
    </div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
let nivel = 3, puntos = 0, frame = 0, items = [], pellets = [];
let jugador = { x: 0, y: 0, w: 0, h: 0, d: 'parado', proximaD: '' };
let enemigos = [];

// Mapa Real de Pac-Man (1=Pared, 0=Camino)
const mapaReal = [
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,0,1,1,1,1,1,0,1,0,1,1,0,1],
    [1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1],
    [1,1,1,1,0,1,1,1,2,1,2,1,1,1,0,1,1,1,1],
    [1,2,2,1,0,1,2,2,2,2,2,2,2,1,0,1,2,2,1],
    [1,1,1,1,0,1,2,1,1,1,1,1,2,1,0,1,1,1,1],
    [1,0,0,0,0,2,2,2,2,2,2,2,2,2,0,0,0,0,1],
    [1,1,1,1,0,1,2,1,1,1,1,1,2,1,0,1,1,1,1],
    [1,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,1],
    [1,0,1,1,0,1,1,1,0,1,0,1,1,1,0,1,1,0,1],
    [1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,1,0,0,1],
    [1,1,0,1,0,1,0,1,1,1,1,1,0,1,0,1,0,1,1],
    [1,0,0,0,0,1,0,0,0,1,0,0,0,1,0,0,0,0,1],
    [1,0,1,1,1,1,1,1,0,1,0,1,1,1,1,1,1,0,1],
    [1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1],
    [1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1,1]
];

const donasPos = [
    {r:1, c:1}, {r:1, c:17}, {r:3, c:9}, {r:5, c:4}, {r:5, c:14},
    {r:11, c:1}, {r:11, c:17}, {r:13, c:7}, {r:17, c:1}, {r:17, c:17}
];

let TW, TH;

function resize() { 
    canvas.width = window.innerWidth; 
    canvas.height = window.innerHeight;
    TW = canvas.width / 19;
    TH = (canvas.height * 0.85) / 19;
    jugador.w = TW * 0.7; jugador.h = TW * 0.7;
}
window.addEventListener('resize', resize); resize();

// CONTROLES (Sin aceleración)
let tX = 0, tY = 0;
window.addEventListener('touchstart', e => { tX = e.touches[0].clientX; tY = e.touches[0].clientY; });
window.addEventListener('touchmove', e => {
    e.preventDefault();
    let dx = e.touches[0].clientX - tX, dy = e.touches[0].clientY - tY;
    if (Math.abs(dx) > Math.abs(dy)) jugador.proximaD = dx > 0 ? 'r' : 'l';
    else jugador.proximaD = dy > 0 ? 'd' : 'u';
}, {passive: false});

// Lógica de colisión para Homero y Enemigos
function puedeMover(x, y, w, h) {
    let margin = 4;
    let pts = [{x: x+margin, y: y+margin}, {x: x+w-margin, y: y+margin}, {x: x+margin, y: y+h-margin}, {x: x+w-margin, y: y+h-margin}];
    return pts.every(p => {
        let gx = Math.floor(p.x / TW), gy = Math.floor(p.y / TH);
        return mapaReal[gy] && mapaReal[gy][gx] !== 1;
    });
}

function motorPacman() {
    ctx.fillStyle = "#000"; ctx.fillRect(0,0,canvas.width, canvas.height);
    
    // Dibujar Paredes
    mapaReal.forEach((f, r) => { f.forEach((c, col) => {
        if(c === 1) { ctx.strokeStyle = "#2424ff"; ctx.strokeRect(col*TW+2, r*TH+2, TW-4, TH-4); }
    });});

    // Comer pellets
    pellets.forEach((p, i) => {
        ctx.fillStyle = "#fff"; ctx.beginPath(); ctx.arc(p.x, p.y, 2, 0, 6.3); ctx.fill();
        if(Math.hypot(jugador.x+jugador.w/2-p.x, jugador.y+jugador.h/2-p.y) < 10) pellets.splice(i, 1);
    });

    // Movimiento Homero
    let v = 2.5;
    if(jugador.proximaD === 'r' && puedeMover(jugador.x+v, jugador.y, jugador.w, jugador.h)) jugador.d = 'r';
    if(jugador.proximaD === 'l' && puedeMover(jugador.x-v, jugador.y, jugador.w, jugador.h)) jugador.d = 'l';
    if(jugador.proximaD === 'u' && puedeMover(jugador.x, jugador.y-v, jugador.w, jugador.h)) jugador.d = 'u';
    if(jugador.proximaD === 'd' && puedeMover(jugador.x, jugador.y+v, jugador.w, jugador.h)) jugador.d = 'd';

    let nx = jugador.x, ny = jugador.y;
    if(jugador.d === 'r') nx += v; if(jugador.d === 'l') nx -= v;
    if(jugador.d === 'u') ny
