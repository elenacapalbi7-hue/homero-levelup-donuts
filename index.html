<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Homer: Nivel 1</title>
    <style>
        /* ESTILO GENERAL */
        body { margin: 0; background: #222; overflow: hidden; font-family: 'Arial', sans-serif; touch-action: none; }
        
        #game-container { 
            position: relative; 
            width: 100vw; 
            height: 100vh; 
            background: #87CEEB; /* Azul cielo */
            margin: 0 auto;
            overflow: hidden;
        }

        /* UI SUPERIOR */
        #ui {
            position: absolute;
            top: 15px;
            width: 100%;
            display: flex;
            justify-content: space-between;
            padding: 0 25px;
            box-sizing: border-box;
            font-size: 26px;
            font-weight: bold;
            color: white;
            text-shadow: 2px 2px 0 #000;
            z-index: 10;
            pointer-events: none;
        }

        /* PANTALLAS (Inicio / Victoria / Game Over) */
        #overlay {
            position: absolute;
            top: 0; left: 0;
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 100;
            text-align: center;
            padding: 20px;
            box-sizing: border-box;
        }
        
        h1 { font-size: 45px; margin: 0 0 15px 0; color: #FFD700; text-shadow: 3px 3px #000; }
        p { font-size: 20px; color: #eee; margin-bottom: 30px; line-height: 1.4; }
        
        .btn-action {
            padding: 15px 50px;
            font-size: 24px;
            background: #FF5722;
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 5px #bf360c;
            font-weight: bold;
        }
        .btn-action:active { transform: translateY(4px); box-shadow: 0 0 #bf360c; }

        /* CONTROLES (AJUSTADOS PARA NO MOLESTAR) */
        #controls {
            position: absolute;
            /* Subimos los controles para evitar gestos del sistema */
            bottom: 100px; 
            width: 100%;
            display: flex;
            justify-content: space-between;
            /* Separaci√≥n lateral para comodidad */
            padding: 0 50px; 
            box-sizing: border-box;
            pointer-events: none; 
            z-index: 20;
        }

        .touch-btn {
            width: 85px;
            height: 85px;
            background: rgba(255, 255, 255, 0.25); /* Un poco m√°s sutiles */
            border: 3px solid rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 45px;
            pointer-events: auto; /* Solo los botones reciben el toque */
            user-select: none;
            color: white;
            /* Efecto pulsaci√≥n */
            transition: background 0.1s;
        }
        
        .touch-btn:active { background: rgba(255,255,255,0.5); transform: scale(0.95); }
        
        canvas { display: block; width: 100%; height: 100%; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="ui">
        <div>üç© <span id="score">0</span> / 15</div>
        <div>‚ù§Ô∏è <span id="lives">3</span></div>
    </div>

    <div id="overlay">
        <h1 id="title">üç© NIVEL 1 üç©</h1>
        <div id="message">
            <p>Atrapa 15 donas para ganar.<br>¬°Evita la comida sana!</p>
        </div>
        <button class="btn-action" id="mainBtn" onclick="startGame()">JUGAR</button>
    </div>

    <canvas id="gameCanvas"></canvas>

    <div id="controls">
        <div class="touch-btn" id="btnLeft">‚¨ÖÔ∏è</div>
        <div class="touch-btn" id="btnRight">‚û°Ô∏è</div>
    </div>
</div>

<script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    const scoreEl = document.getElementById('score');
    const livesEl = document.getElementById('lives');
    const overlay = document.getElementById('overlay');
    const title = document.getElementById('title');
    const message = document.getElementById('message');
    const mainBtn = document.getElementById('mainBtn');

    let animationId;
    let isPlaying = false;
    let score = 0;
    let lives = 3;
    let frameCount = 0;
    
    // Configuraci√≥n del Jugador
    const player = {
        x: 0,
        y: 0,
        width: 80,
        height: 100,
        speed: 8, // Un poco m√°s r√°pido por defecto
        emoji: "üë®‚Äçü¶≤",
        isPowerUp: false
    };

    // Objetos (Items)
    let items = [];
    
    // Lista de enemigos (Comida sana variada)
    const badItems = ['ü•¶', 'ü•ï', 'üçÖ', 'üçÜ', 'ü•í', 'ü•ó'];

    // Controles
    let keys = { left: false, right: false };

    // Ajustar pantalla
    function resize() {
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;
        player.y = canvas.height - player.height - 20; 
        // Mantener posici√≥n relativa o centrar si acaba de iniciar
        if(!isPlaying) player.x = canvas.width / 2 - player.width / 2;
        else {
            // Asegurar que no quede fuera al redimensionar
            if(player.x > canvas.width - player.width) player.x = canvas.width - player.width;
        }
    }
    window.addEventListener('resize', resize);
    resize();

    // Iniciar
    function startGame() {
        items = [];
        score = 0;
        lives = 3;
        player.isPowerUp = false;
        player.speed = 8;
        player.x = canvas.width / 2 - player.width / 2;
        
        scoreEl.innerText = score;
        livesEl.innerText = lives;
        
        isPlaying = true;
        overlay.style.display = 'none';
        
        cancelAnimationFrame(animationId);
        loop();
    }

    // Ganaste Nivel
    function winLevel() {
        isPlaying = false;
        overlay.style.display = 'flex';
        title.innerText = "¬°EXCELENTE!";
        title.style.color = "#4CAF50"; // Verde victoria
        message.innerHTML = "<p>¬°Comiste 15 donas!<br>Nivel 1 Completado.</p>";
        mainBtn.innerText = "SIGUIENTE NIVEL";
        mainBtn.onclick = function() {
            alert("¬°Aqu√≠ cargar√≠a el Nivel 2! (Pr√≥ximamente)");
            // Aqu√≠ pondremos la l√≥gica para cargar el otro HTML del Nivel 2
            location.reload(); // Por ahora reinicia
        };
    }

    // Perdiste
    function gameOver() {
        isPlaying = false;
        overlay.style.display = 'flex';
        title.innerText = "¬°D'OH!";
        title.style.color = "#F44336"; // Rojo derrota
        message.innerHTML = `<p>Te obligaron a hacer dieta.<br>Solo comiste ${score} donas.</p>`;
        mainBtn.innerText = "REINTENTAR";
        mainBtn.onclick = startGame;
    }

    // Crear Objetos
    function spawnItem() {
        const typeRoll = Math.random();
        let type, emoji, speed;

        // Probabilidades: 
        // 10% S√°ndwich (PowerUp)
        // 40% Enemigos variados
        // 50% Dona

        if (typeRoll < 0.1) {
            type = 'sandwich';
            emoji = 'ü•™';
            speed = 8; 
        } else if (typeRoll < 0.5) {
            type = 'bad';
            // Elegir verdura al azar
            emoji = badItems[Math.floor(Math.random() * badItems.length)];
            speed = 5 + (Math.random() * 2); // Velocidad variable
        } else {
            type = 'donut';
            emoji = 'üç©';
            speed = 4 + (Math.random() * 2);
        }

        const size = 50;
        const x = Math.random() * (canvas.width - size);
        
        items.push({ x, y: -60, size, type, emoji, speed });
    }

    // Bucle del Juego
    function loop() {
        if (!isPlaying) return;

        ctx.clearRect(0, 0, canvas.width, canvas.height);

        // 1. Fondo (C√©sped)
        ctx.fillStyle = "#4CAF50";
        ctx.fillRect(0, canvas.height - 25, canvas.width, 25);

        // 2. Jugador
        if (keys.left && player.x > 0) player.x -= player.speed;
        if (keys.right && player.x < canvas.width - player.width) player.x += player.speed;

        // Aura de PowerUp
        if(player.isPowerUp) {
            ctx.beginPath();
            ctx.fillStyle = 'rgba(255, 255, 0, 0.4)';
            ctx.arc(player.x + player.width/2, player.y + player.height/2, 60, 0, Math.PI*2);
            ctx.fill();
        }

        ctx.font = `${player.height}px Arial`;
        ctx.fillText(player.emoji, player.x, player.y + player.height - 10);

        // 3. Items
        // Generar items cada ~0.8 segundos (60 frames = 1 seg aprox)
        if (frameCount % 50 === 0) spawnItem();

        for (let i = items.length - 1; i >= 0; i--) {
            let item = items[i];
            item.y += item.speed;

            ctx.font = `${item.size}px Arial`;
            ctx.fillText(item.emoji, item.x, item.y + item.size);

            // Colisi√≥n
            if (
                player.x < item.x + item.size &&
                player.x + player.width > item.x &&
                player.y < item.y + item.size &&
                player.y + player.height > item.y
            ) {
                // L√≥gica de colisi√≥n
                if (item.type === 'donut') {
                    score++;
                    scoreEl.innerText = score;
                    // CHEQUEO DE VICTORIA
                    if(score >= 15) {
                        winLevel();
                        return; // Salir del loop
                    }
                } else if (item.type === 'sandwich') {
                    player.speed = 14; 
                    player.isPowerUp = true;
                    setTimeout(() => { player.speed = 8; player.isPowerUp = false; }, 5000);
                } else if (item.type === 'bad') {
                    lives--;
                    livesEl.innerText = lives;
                    ctx.fillStyle = 'rgba(255,0,0,0.5)';
                    ctx.fillRect(0,0,canvas.width,canvas.height);
                    if(lives <= 0) {
                        gameOver();
                        return;
                    }
                }
                items.splice(i, 1);
                continue;
            }

            if (item.y > canvas.height) items.splice(i, 1);
        }

        frameCount++;
        animationId = requestAnimationFrame(loop);
    }

    // --- ENTRADAS T√ÅCTILES Y TECLADO ---
    
    // PC
    window.addEventListener('keydown', e => {
        if(e.key === 'ArrowLeft') keys.left = true;
        if(e.key === 'ArrowRight') keys.right = true;
    });
    window.addEventListener('keyup', e => {
        if(e.key === 'ArrowLeft') keys.left = false;
        if(e.key === 'ArrowRight') keys.right = false;
    });

    // M√ìVIL (Botones)
    const btnLeft = document.getElementById('btnLeft');
    const btnRight = document.getElementById('btnRight');

    const setupBtn = (btn, dir) => {
        btn
