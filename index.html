<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Homero: Los 5 Niveles Completos</title>
    <style>
        body { margin: 0; background: #000; color: #fff; font-family: sans-serif; overflow: hidden; touch-action: none; }
        canvas { display: block; width: 100vw; height: 100vh; }
        #ui { position: absolute; top: 10px; width: 100%; text-align: center; pointer-events: none; z-index: 100; }
        .hud { background: rgba(0,0,0,0.8); padding: 10px; border: 2px solid #ff69b4; border-radius: 10px; display: inline-block; }
    </style>
</head>
<body>

<div id="ui">
    <div class="hud">
        <strong id="lvl-name">Nivel 1: RITMO (Obst√°culos)</strong><br>
        Donas: <span id="puntos">0</span>/10
    </div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
}
window.addEventListener('resize', resize);
resize();

// --- VARIABLES DE ESTADO ---
let nivel = 1;
let puntos = 0;
let frame = 0;
let items = [];
let jugador = { x: 50, y: 0, w: 40, h: 60, vy: 0, saltos: 0 };
let toque = { x: 0, y: 0 };

// RPG Stats (Nivel 3)
let energiaRPG = 0; 
let enemigoHP = 100;

// --- CONTROLES UNIVERSALES ---
window.addEventListener('touchstart', (e) => {
    let t = e.touches[0];
    toque.x = t.clientX; toque.y = t.clientY;
    
    if (nivel === 1 && jugador.saltos < 2) {
        jugador.vy = -13;
        jugador.saltos++;
    }
    if (nivel === 3) intentarAtaqueRPG();
    if (nivel === 5) dispararFPS();
}, {passive: false});

window.addEventListener('touchmove', (e) => {
    e.preventDefault();
    let t = e.touches[0];
    toque.x = t.clientX; toque.y = t.clientY;
    
    // Movimiento libre para Survivor, Nave y FPS
    if ([2, 4, 5].includes(nivel)) {
        jugador.x = toque.x - 20;
        jugador.y = toque.y - 30;
    }
}, {passive: false});

// --- BUCLE PRINCIPAL ---
function loop() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    frame++;

    // Switch de niveles (Los 5 juegos)
    switch(nivel) {
        case 1: motorRitmo(); break;
        case 2: motorSurvivor(); break;
        case 3: motorRPG(); break;
        case 4: motorNave(); break;
        case 5: motorFPS(); break;
    }

    requestAnimationFrame(loop);
}

// 1. JUEGO DE OBST√ÅCULOS (R√≠tmico)
function motorRitmo() {
    ctx.fillStyle = "#1a1a2e"; ctx.fillRect(0,0,canvas.width, canvas.height);
    ctx.fillStyle = "#ff69b4"; ctx.fillRect(0, canvas.height-50, canvas.width, 50);
    
    jugador.vy += 0.7; jugador.y += jugador.vy;
    if(jugador.y > canvas.height-110) { 
        jugador.y = canvas.height-110; 
        jugador.vy = 0; 
        jugador.saltos = 0; 
    }
    
    if(frame % 130 === 0) items.push({x: canvas.width, y: canvas.height-95, tipo: 'obs'});
    if(frame % 170 === 0) items.push({x: canvas.width, y: canvas.height-220, tipo: 'dona'});
    
    for(let i=items.length-1; i>=0; i--) {
        let it = items[i];
        it.x -= 4; // Velocidad lenta
        ctx.font = "35px Arial";
        ctx.fillText(it.tipo === 'obs' ? "üåµ" : "üç©", it.x, it.y);
        
        // Colisi√≥n ajustada (Hitbox peque√±a para el cactus)
        let hitW = it.tipo === 'obs' ? 15 : 50;
        if (jugador.x < it.x + hitW && jugador.x + 30 > it.x &&
            jugador.y < it.y + 40 && jugador.y + 50 > it.y) {
            if(it.tipo === 'obs') reiniciarNivel();
            else { items.splice(i, 1); sumarPunto(); }
        }
        if(it.x < -50) items.splice(i,1);
    }
    dibujarHomero();
}

// 2. SUPERVIVENCIA (Mundo Abierto / Zombis)
function motorSurvivor() {
    ctx.fillStyle = "#2d3436"; ctx.fillRect(0,0,canvas.width, canvas.height);
    if(frame % 110 === 0) items.push({x: Math.random()*canvas.width, y: -50, tipo: 'zombi', s: 1.2});
    if(frame % 150 === 0) items.push({x: Math.random()*canvas.width, y: Math.random()*canvas.height, tipo: 'dona'});
    
    for(let i=items.length-1; i>=0; i--) {
        let it = items[i];
        if(it.tipo === 'zombi') {
            let angle = Math.atan2(jugador.y - it.y, jugador.x - it.x);
            it.x += Math.cos(angle) * it.s; it.y += Math.sin(angle) * it.s;
            ctx.font = "30px Arial"; ctx.fillText("üßü", it.x, it.y);
            if(Math.hypot(jugador.x - it.x, jugador.y - it.y) < 30) reiniciarNivel();
        } else {
            ctx.font = "35px Arial"; ctx.fillText("üç©", it.x, it.y);
            if(Math.hypot(jugador.x - it.x, jugador.y - it.y) < 60) { items.splice(i, 1); sumarPunto(); }
        }
    }
    dibujarHomero();
}

// 3. JUEGO DE ROL (Combate por Turnos)
function motorRPG() {
    ctx.fillStyle = "#2c3e50"; ctx.fillRect(0,0,canvas.width, canvas.height);
    if(energiaRPG < 100) energiaRPG += 0.8;
    
    ctx.fillStyle = "gray"; ctx.fillRect(50, 50, canvas.width-100, 20);
    ctx.fillStyle = "lime"; ctx.fillRect(50, 50, (energiaRPG/100)*(canvas.width-100), 20);
    
    ctx.font = "100px Arial"; ctx.fillText("üßå", canvas.width/2-50, canvas.height/2);
    ctx.font = "20px Arial"; ctx.fillStyle = "white";
    ctx.fillText("HP ENEMIGO: " + enemigoHP, 50, 110);
    if(energiaRPG >= 100) ctx.fillText("¬°LISTO! TOCA AL ENEMIGO", canvas.width/2-100, canvas.height/2+100);
    
    dibujarHomero();
}

function intentarAtaqueRPG() {
    if(energiaRPG >= 100) {
        enemigoHP -= 20;
        energiaRPG = 0;
        sumarPunto();
        if(enemigoHP <= 0) enemigoHP = 100;
    }
}

// 4. PLATAFORMAS / NAVE (Vuelo Vertical)
function motorNave() {
    ctx.fillStyle = "#000022"; ctx.fillRect(0,0,canvas.width, canvas.height);
    if(frame % 60 === 0) items.push({x: Math.random()*canvas.width, y: -50, tipo: 'obs', s: 5});
    if(frame % 100 === 0) items.push({x: Math.random()*canvas.width, y: -50, tipo: 'dona', s: 4});
    
    for(let i=items.length-1; i>=0; i--) {
        let it = items[i]; it.y += it.s;
        ctx.font = "35px Arial"; ctx.fillText(it.tipo === 'obs' ? "‚òÑÔ∏è" : "üç©", it.x, it.y);
        if(Math.hypot(jugador.x - it.x, jugador.y - it.y) < 55) {
            if(it.tipo === 'obs') reiniciarNivel();
            else { items.splice(i, 1); sumarPunto(); }
        }
        if(it.y > canvas.height) items.splice(i,1);
    }
    dibujarHomero();
}

// 5. TIRADOR FPS (T√°ctico)
function motorFPS() {
    ctx.fillStyle = "#1a1a1a"; ctx.fillRect(0,0,canvas.width, canvas.height);
    ctx.strokeStyle = "cyan"; ctx.lineWidth = 3;
    ctx.strokeRect(toque.x-30, toque.y-30, 60, 60); // Mira
    
    if(frame % 60 === 0) items.push({x: 50+Math.random()*(canvas.width-100), y: 50+Math.random()*(canvas.height-100)});
    
    items.forEach(it => { ctx.font="50px Arial"; ctx.fillText("üéØ", it.x, it.y); });
}

function dispararFPS() {
    for(let i=items.length-1; i>=0; i--) {
        if(Math.hypot(toque.x - items[i].x, toque.y - items[i].y) < 70) {
            items.splice(i, 1);
            sumarPunto();
        }
    }
}

// --- UTILIDADES ---
function dibujarHomero() {
    ctx.fillStyle = "yellow";
    ctx.fillRect(jugador.x, jugador.y, 40, 60);
    ctx.strokeStyle = "white"; ctx.strokeRect(jugador.x, jugador.y, 40, 60);
}

function sumarPunto() {
    puntos++;
    document.getElementById('puntos').innerText = puntos;
    if(puntos >= 10) cambiarNivel();
}

function reiniciarNivel() {
    puntos = 0; items = []; frame = 0;
    document.getElementById('puntos').innerText = "0";
    alert("¬°D'oh! Reintentando...");
}

function cambiarNivel() {
    nivel++;
    puntos = 0; items = []; frame = 0;
    energiaRPG = 0; enemigoHP = 100;
    document.getElementById('puntos').innerText = "0";
    
    if(nivel > 5) {
        alert("¬°FELICIDADES! HAS COMPLETADO LOS 5 NIVELES");
        nivel = 1;
    }
    
    const nombres = ["", "1. RITMO", "2. SUPERVIVENCIA", "3. ROL (RPG)", "4. NAVE ESPACIAL", "5. SHOOTER T√ÅCTICO"];
    document.getElementById('lvl-name').innerText = "Nivel " + nombres[nivel];
    alert("Cargando " + nombres[nivel]);
}

loop();
</script>
</body>
</html>
