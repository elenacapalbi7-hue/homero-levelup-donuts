<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Homer World 1-1</title>
    <style>
        body { margin: 0; background: #5c94fc; overflow: hidden; touch-action: none; font-family: 'Arial', sans-serif; }
        #ui { position: absolute; top: 0; width: 100%; z-index: 100; pointer-events: none; color: white; text-shadow: 2px 2px #000; }
        .hud { display: flex; justify-content: space-around; padding: 15px; font-size: 1.5rem; font-weight: bold; }
        canvas { display: block; width: 100vw; height: 100vh; image-rendering: pixelated; }
    </style>
</head>
<body>

<div id="ui">
    <div class="hud">
        <div>HOMERO<br><span id="puntos">000000</span></div>
        <div>DONAS<br>üç© x <span id="donasCount">0</span></div>
        <div>MUNDO<br>1-1</div>
        <div>VIDAS<br><span id="vidas">3</span></div>
    </div>
</div>

<canvas id="canvas"></canvas>

<script>
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');

// --- CONFIGURACI√ìN DE F√çSICA ESTILO MARIO ---
const GRAVEDAD = 0.8;
const FRICCION = 0.85;
const ACEL_CAMINAR = 1.5;
const SALTO_FUERZA = -16;
const VEL_MAX = 6;

let nivel = 4; // Empezamos en el nivel de Mario para probarlo
let puntos = 0, donas = 0, vidas = 3, frame = 0, camX = 0;
let bloques = [], enemigos = [], items = [];

let h = { 
    x: 100, y: 0, w: 40, h: 50, 
    vx: 0, vy: 0, 
    enSuelo: false, saltando: false,
    dir: 1 // 1 derecha, -1 izquierda
};

// --- CONTROLES T√ÅCTILES MEJORADOS ---
let touchX = null;
window.addEventListener('touchstart', e => {
    const tx = e.touches[0].clientX;
    if (tx > window.innerWidth / 2) h.vx += ACEL_CAMINAR;
    else h.vx -= ACEL_CAMINAR;
    
    if (!h.saltando) {
        h.vy = SALTO_FUERZA;
        h.saltando = true;
    }
    touchX = tx;
}, {passive: false});

window.addEventListener('touchmove', e => {
    e.preventDefault();
    const tx = e.touches[0].clientX;
    if (tx > window.innerWidth / 2) h.vx = VEL_MAX;
    else h.vx = -VEL_MAX;
}, {passive: false});

window.addEventListener('touchend', () => { touchX = null; });

function crearMundo1_1() {
    bloques = []; enemigos = []; items = [];
    // Suelo estilo Mario (Ladrillo naranja)
    for(let i=0; i<300; i++) {
        if (i < 80 || (i > 85 && i < 150) || i > 155) { // Huecos en el suelo
            bloques.push({x: i*40, y: canvas.height-40, t:'S'});
            bloques.push({x: i*40, y: canvas.height-80, t:'S'});
        }
    }
    // Bloques interrogaci√≥n y ladrillos
    const layout = [
        {x: 16, y: 5, t:'?'}, {x: 20, y: 5, t:'L'}, {x: 21, y: 5, t:'?'}, {x: 22, y: 5, t:'L'}, {x: 23, y: 5, t:'?'}, {x: 24, y: 5, t:'L'}
    ];
    layout.forEach(b => bloques.push({x: b.x*40, y: canvas.height-80-(b.y*40), t: b.t}));

    // Tuber√≠as verdes (Plantas Nucleares)
    [35, 50, 65].forEach(tx => {
        bloques.push({x: tx*40, y: canvas.height-120, w:80, h:40, t:'T'});
        bloques.push({x: tx*40, y: canvas.height-160, w:80, h:40, t:'T'});
    });

    // Flanders (Enemigos Goomba)
    for(let i=0; i<15; i++) enemigos.push({x: 800 + i*600, y: canvas.height-120, vx: -2, vivo: true});
}

function actualizar() {
    // Aplicar F√≠sica
    h.vy += GRAVEDAD;
    h.y += h.vy;
    
    // Movimiento con Inercia
    if (touchX === null) h.vx *= FRICCION; 
    if (Math.abs(h.vx) < 0.2) h.vx = 0;
    h.x += h.vx;

    // Scroll de c√°mara
    if (h.x > camX + canvas.width/2) camX = h.x - canvas.width/2;

    // Colisiones con Bloques
    h.enSuelo = false;
    bloques.forEach(b => {
        let bw = b.w || 40;
        let bh = b.h || 40;
        
        if (h.x + h.w > b.x && h.x < b.x + bw && h.y + h.h > b.y && h.y < b.y + bh) {
            // Colisi√≥n por arriba (Suelo)
            if (h.vy > 0 && h.y + h.h - h.vy <= b.y) {
                h.y = b.y - h.h;
                h.vy = 0;
                h.enSuelo = true;
                h.saltando = false;
            }
            // Colisi√≥n por abajo (Golpear bloque)
            else if (h.vy < 0 && h.y - h.vy >= b.y + bh) {
                h.y = b.y + bh;
                h.vy = 2;
                if (b.t === '?') {
                    b.t = 'L'; // Se vuelve ladrillo usado
                    donas++;
                    puntos += 200;
                }
            }
            // Colisi√≥n lateral
            else {
                h.x -= h.vx;
                h.vx = 0;
            }
        }
    });

    // Enemigos (Flanders)
    enemigos.forEach((en, i) => {
        if (!en.vivo) return;
        en.x += en.vx;
        // Colisi√≥n con Homero
        if (h.x + h.w > en.x && h.x < en.x + 40 && h.y + h.h > en.y && h.y < en.y + 40) {
            if (h.vy > 0) { // Lo pisa
                en.vivo = false;
                h.vy = -10;
                puntos += 100;
            } else { // Muere Homero
                morir();
            }
        }
    });

    // Ca√≠da al vac√≠o
    if (h.y > canvas.height) morir();
}

function dibujar() {
    ctx.clearRect(0,0, canvas.width, canvas.height);
    ctx.save();
    ctx.translate(-camX, 0);

    // Fondo: Nubes y Monta√±as
    ctx.font = "80px Arial";
    ctx.fillText("‚òÅÔ∏è", 300 + camX*0.2, 100);
    ctx.fillText("‚õ∞Ô∏è", 500 + camX*0.1, canvas.height-150);

    // Dibujar Bloques
    bloques.forEach(b => {
        if (b.t === 'S' || b.t === 'L') ctx.fillStyle = "#e76e33"; // Ladrillo
        else if (b.t === '?') ctx.fillStyle = "#f39c12"; // Interrogaci√≥n
        else if (b.t === 'T') ctx.fillStyle = "#27ae60"; // Tuber√≠a
        
        ctx.fillRect(b.x, b.y, b.w || 40, b.h || 40);
        ctx.strokeStyle = "black";
        ctx.strokeRect(b.x, b.y, b.w || 40, b.h || 40);
        if(b.t === '?') { ctx.fillStyle="white"; ctx.font="20px Arial"; ctx.fillText("?", b.x+12, b.y+28); }
    });

    // Dibujar Enemigos
    enemigos.forEach(en => {
        if (en.vivo) {
            ctx.font = "40px Arial";
            ctx.fillText("üë®‚Äçüè´", en.x, en.y + 35);
        }
    });

    // Dibujar Homero
    ctx.font = "50px Arial";
    ctx.fillText("üë®‚Äçü¶≤", h.x, h.y + 45);

    // Meta (Bandera)
    ctx.fillText("üèÅ", 11000, canvas.height-200);
    ctx.fillText("üè†", 11100, canvas.height-140);

    ctx.restore();

    // Actualizar HUD
    document.getElementById('donasCount').innerText = donas;
    document.getElementById('puntos').innerText = String(puntos).padStart(6, '0');
    document.getElementById('vidas').innerText = vidas;
}

function morir() {
    vidas--;
    if (vidas <= 0) { alert("GAME OVER"); vidas = 3; puntos = 0; donas = 0; }
    h.x = 100; h.y = 0; h.vx = 0; h.vy = 0;
    camX = 0;
    crearMundo1_1();
}

function loop() {
    actualizar();
    dibujar();
    requestAnimationFrame(loop);
}

window.onload = () => {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    crearMundo1_1();
    loop();
};
</script>
</body>
</html>
