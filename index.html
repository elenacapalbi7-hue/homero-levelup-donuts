<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Homer Odyssey - Unique Mechanics</title>
    <style>
        body { margin: 0; background: #000; overflow: hidden; font-family: sans-serif; touch-action: none; }
        #game-wrap { position: relative; width: 100vw; height: 100vh; background: #050510; }
        canvas { display: block; width: 100%; height: 100%; }

        #hud { position: absolute; top: 40px; width: 100%; display: flex; justify-content: space-around; 
               color: #FFD700; font-weight: bold; font-size: 18px; z-index: 10; pointer-events: none; text-shadow: 2px 2px #000; }

        /* BOT√ìN DE ACCI√ìN √öNICA (ELEVADO) */
        #action-btn { 
            position: absolute; bottom: 220px; right: 40px; 
            width: 110px; height: 110px; background: rgba(255, 215, 0, 0.2); 
            border: 4px solid #FFD700; border-radius: 50%; 
            display: flex; justify-content: center; align-items: center; 
            font-size: 45px; z-index: 100; touch-action: none;
        }

        #overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; 
                   background: rgba(0,0,0,0.9); display: flex; flex-direction: column; 
                   justify-content: center; align-items: center; color: white; z-index: 200; text-align: center; }
        .start-btn { padding: 18px 50px; font-size: 22px; background: #FFD700; border: none; border-radius: 12px; font-weight: bold; color: black; }
    </style>
</head>
<body>

<div id="game-wrap">
    <div id="hud">
        <div>NIVEL: <span id="txt-lvl">1</span></div>
        <div>üç©: <span id="txt-donuts">0</span>/10</div>
        <div>‚ù§Ô∏è: <span id="txt-lives">3</span></div>
    </div>

    <canvas id="screen"></canvas>
    <div id="action-btn">üç©</div>

    <div id="overlay">
        <h1 id="m-title">HOMER DASH</h1>
        <p id="m-desc">Cargando mec√°nica √∫nica...</p>
        <button class="start-btn" onclick="init()">¬°VAMOS!</button>
    </div>
</div>

<script>
    const canvas = document.getElementById('screen');
    const ctx = canvas.getContext('2d');
    
    let level = 1, donuts = 0, lives = 3, active = false, frame = 0;
    let player = { x: 80, y: 0, w: 45, h: 55, vx: 0, vy: 0, g: 0.6, grounded: false, inv: 1 };
    let platforms = [], items = [], hazards = [];
    let isPressing = false;

    function setup() { canvas.width = window.innerWidth; canvas.height = window.innerHeight; }
    window.addEventListener('resize', setup);
    setup();

    function createLevel(lvl) {
        platforms = []; items = []; hazards = []; donuts = 0; frame = 0;
        document.getElementById('txt-donuts').innerText = "0/10";
        document.getElementById('txt-lvl').innerText = lvl;
        player.y = canvas.height - 150; player.vy = 0; player.inv = 1;

        // GENERADOR DE DESNIVELES (Plataformas asim√©tricas)
        for(let i=0; i<15; i++) {
            let px = 300 + (i * 350);
            let py = canvas.height - (150 + Math.random() * 250);
            platforms.push({x: px, y: py, w: 120 + Math.random()*100, h: 25});
            items.push({x: px + 40, y: py - 50});
            if(lvl > 1) hazards.push({x: px + 200, y: canvas.height - 85, w: 40, h: 40});
        }
    }

    function update() {
        if(!active) return;
        frame++;

        // MEC√ÅNICAS SEG√öN NIVEL
        if(level === 1) player.vx = 4.5; // Auto-run simple
        if(level === 2) { player.vx = 3.5; if(frame % 100 === 0) hazards.push({x: player.x + 500, y: -50, vy: 4}); } // Ca√≠da de objetos
        if(level === 3) { player.inv = -1; player.vx = 5; } // Gravedad invertida
        if(level === 4) { if(isPressing) player.vy -= 1.2; player.vx = 4; } // Modo Jetpack
        if(level === 5) { player.vx = 8; } // Super velocidad hielo

        player.vy += (player.g * player.inv);
        player.y += player.vy;
        player.x += player.vx;

        // COLISI√ìN S√ìLIDA (No traspasar)
        player.grounded = false;
        platforms.forEach(p => {
            // Colisi√≥n superior
            if(player.x + player.w > p.x && player.x < p.x + p.w &&
               player.y + player.h > p.y && player.y + player.h < p.y + p.h + 10 && (player.vy * player.inv) > 0) {
                player.y = (player.inv === 1) ? p.y - player.h : p.y + p.h;
                player.vy = 0;
                player.grounded = true;
            }
        });

        // Suelo y Techo
        if(player.y > canvas.height - 95) { player.y = canvas.height-95; player.vy = 0; player.grounded = true; }
        if(player.y < 0) { player.y = 0; player.vy = 0; }

        // Recoger Donas
        items.forEach((it, i) => {
            if(Math.hypot(player.x - it.x, player.y - it.y) < 50) {
                donuts++; items.splice(i, 1);
                document.getElementById('txt-donuts').innerText = donuts + "/10";
                if(donuts >= 10) nextLevel();
            }
        });

        // Obst√°culos
         hazards.forEach(h => {
            if(h.vy) h.y += h.vy;
            if(player.x < h.x + (h.w||40) && player.x + player.w > h.x && player.y < h.y + (h.h||40) && player.y + player.h > h.y) die();
        });
    }

    function render() {
        ctx.fillStyle = level % 2 === 0 ? "#05051a" : "#1a0505";
        ctx.fillRect(0,0,canvas.width, canvas.height);
        
        ctx.save();
        ctx.translate(-player.x + 80, 0);

        // Suelo
        ctx.fillStyle = "#222"; ctx.fillRect(player.x - 100, canvas.height-45, canvas.width + 1000, 45);

        // Plataformas desparejas
        ctx.fillStyle = "#FFD700";
        platforms.forEach(p => ctx.fillRect(p.x, p.y, p.w, p.h));

        // Donas y Peligros
        ctx.font = "40px Arial";
        items.forEach(it => ctx.fillText("üç©", it.x, it.y));
        hazards.forEach(h => ctx.fillText("üî•", h.x, h.y + 35));

        // Homero
        ctx.save();
        if(player.inv === -1) { ctx.scale(1, -1); ctx.fillText("üèÉ‚Äç‚ôÇÔ∏è", player.x, -(player.y + 10)); }
        else { ctx.fillText("üèÉ‚Äç‚ôÇÔ∏è", player.x, player.y + 50); }
        ctx.restore();

        ctx.restore();
        if(active) { update(); requestAnimationFrame(render); }
    }

    const actBtn = document.getElementById('action-btn');
    actBtn.ontouchstart = (e) => { 
        e.preventDefault(); isPressing = true;
        if(player.grounded) player.vy = -14 * player.inv;
    };
    actBtn.ontouchend = () => isPressing = false;

    function die() {
        active = false; lives--; document.getElementById('txt-lives').innerText = lives;
        if(lives <= 0) { level=1; lives=3; document.getElementById('m-title').innerText = "¬°D'OH!"; }
        document.getElementById('overlay').style.display = "flex";
    }

    function nextLevel() { active = false; level++; document.getElementById('m-title').innerText = "¬°EXCELENTE!"; document.getElementById('overlay').style.display = "flex"; }
    function init() { document.getElementById('overlay').style.display = "none"; createLevel(level); active = true; render(); }
</script>
</body>
</html>
